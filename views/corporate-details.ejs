<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= corporates.corporateName %> - Details</title>
</head>
<body>
  <h1><%= corporates.corporateName %></h1>
  <p>Follower Count: <%= followerCount %></p>

  <!-- Cover Image -->
  <div class="cover-image">
    <% if (corporates.coverPhoto && corporates.coverPhoto.data) { %>
      <img src="data:<%= corporates.coverPhoto.contentType %>;base64,<%= corporates.coverPhoto.data.toString('base64') %>" alt="Cover Photo" style="width:100%; height:auto; max-height: 300px;">
    <% } else { %>
      <p>No cover photo available</p>
    <% } %>
  </div>

  <!-- Profile Image -->
  <div class="profile-image">
    <% if (corporates.profilePicture && corporates.profilePicture.data) { %>
      <img src="data:<%= corporates.profilePicture.contentType %>;base64,<%= corporates.profilePicture.data.toString('base64') %>" alt="Profile Image" style="width:150px; height:auto;">
    <% } else { %>
      <p>No profile image available</p>
    <% } %>
  </div>

  <!-- Tagline -->
  <p><strong>Tagline:</strong> <%= corporates.tagline || 'Not provided' %></p>

  <!-- Overview -->
  <p><strong>Overview:</strong> <%= corporates.overview || 'Not provided' %></p>

  <!-- Address -->
  <div class="address">
    <p><strong>Address:</strong> 
      <% if (corporates.address) { %>
        <%= corporates.address.street %>, <%= corporates.address.city %>, <%= corporates.address.state %>, <%= corporates.address.zipCode %>, <%= corporates.address.country %>
      <% } else { %>
        Not provided
      <% } %>
    </p>
  </div>

  <!-- Business Type -->
  <p><strong>Business Type:</strong> <%= corporates.businessType || 'Not provided' %></p>

  <!-- Corporate Specialties -->
  <h3>Our Specialties:</h3>
  <% if (doctors && doctors.length > 0) { %>
    <div class="corporate-specialities">
      <% 
        let uniqueSpecialties = new Set();
        doctors.forEach(doctor => {
          if (doctor.speciality && doctor.speciality.length > 0) {
            doctor.speciality.forEach(speciality => {
              uniqueSpecialties.add(speciality);
            });
          }
        });

        uniqueSpecialties.forEach(speciality => { 
      %>
        <div class="speciality-item">
          <a href="#" class="speciality-link" data-speciality="<%= speciality %>"><%= speciality %></a>
        </div>
      <% }) %>
      <!-- Reset Button -->
      <button id="reset-button" style="margin-top: 10px;">Reset</button>
    </div>
  <% } else { %>
    <p>No specialties available.</p>
  <% } %>

  <!-- Follow/Unfollow Button -->
  <form action="/patient/corporate/<%= corporates._id %>/follow" method="POST">
    <button type="submit"><%= isFollowing ? 'Unfollow' : 'Follow' %></button>
  </form>

  <h2>Doctors in <%= corporates.corporateName %></h2>
  <% if (doctors.length > 0) { %>
    <ul id="doctor-list">
      <% doctors.forEach(doctor => { %>
        <li class="doctor-item" data-speciality="<%= doctor.speciality.join(', ') %>">
          <div class="doctor-profile">
            <h3>Doctor Name: <%= doctor.name %></h3>

            <!-- Profile Picture -->
            <% if (doctor.profilePicture && doctor.profilePicture.data) { %>
              <img src="data:<%= doctor.profilePicture.contentType %>;base64,<%= doctor.profilePicture.data.toString('base64') %>" alt="Profile Picture" width="150" height="180">
            <% } else { %>
              <p>No profile picture available</p>
            <% } %>

            <!-- Actions -->
            <div class="actions">
              <a href="/patient/doctors/<%= doctor._id %>/slots">Book Appointment</a>
            </div>
          </div>
          <hr>
        </li>
      <% }) %>
    </ul>
  <% } else { %>
    <p>No doctors found in this corporate.</p>
  <% } %>

  <a href="/patient/corporate-list">Back to Corporate List</a>

  <!-- JavaScript for specialty filtering and reset functionality -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const specialityLinks = document.querySelectorAll('.speciality-link');
      const doctorItems = document.querySelectorAll('.doctor-item');
      const resetButton = document.getElementById('reset-button');

      specialityLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const selectedSpeciality = this.getAttribute('data-speciality');

          // Hide all doctors initially
          doctorItems.forEach(function(item) {
            item.style.display = 'none';
          });

          // Show only doctors that match the selected speciality
          doctorItems.forEach(function(item) {
            if (item.getAttribute('data-speciality').includes(selectedSpeciality)) {
              item.style.display = 'block';
            }
          });
        });
      });

      // Reset button functionality
      resetButton.addEventListener('click', function() {
        // Show all doctors
        doctorItems.forEach(function(item) {
          item.style.display = 'block';
        });
      });
    });
  </script>
</body>
</html>
